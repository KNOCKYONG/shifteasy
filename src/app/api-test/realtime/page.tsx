"use client";
import { useState, useEffect, useRef } from "react";
import { Bell, Wifi, WifiOff, Send, Trash2, Check, X, AlertCircle, RefreshCw } from "lucide-react";
import { SSEClient } from "@/lib/sse/client";

export default function RealtimeApiTestPage() {
  const [activeTab, setActiveTab] = useState<'sse' | 'push' | 'notifications' | 'guide'>('guide');
  const [sseConnected, setSseConnected] = useState(false);
  const [sseEvents, setSseEvents] = useState<Array<{ time: string; type: string; data: any }>>([]);
  const [pushSubscribed, setPushSubscribed] = useState(false);
  const [notifications, setNotifications] = useState<any[]>([]);
  const [unreadCount, setUnreadCount] = useState(0);
  const sseClientRef = useRef<SSEClient | null>(null);

  // SSE Connection
  useEffect(() => {
    const client = new SSEClient({
      url: '/api/sse',
      headers: {
        'x-tenant-id': 'test-tenant',
        'x-user-id': 'test-user',
      },
      onOpen: () => {
        setSseConnected(true);
        console.log('SSE connected');
      },
      onClose: () => {
        setSseConnected(false);
        console.log('SSE disconnected');
      },
      onError: (error) => {
        console.error('SSE error:', error);
      },
      onReconnect: (attempt) => {
        console.log(`SSE reconnecting... attempt ${attempt}`);
      },
    });

    // Listen for events
    client.on('connected', (event) => {
      const data = JSON.parse(event.data);
      addSseEvent('connected', data);
    });

    client.on('notification', (event) => {
      const data = JSON.parse(event.data);
      addSseEvent('notification', data);
    });

    client.on('schedule.updated', (event) => {
      const data = JSON.parse(event.data);
      addSseEvent('schedule.updated', data);
    });

    client.on('swap.requested', (event) => {
      const data = JSON.parse(event.data);
      addSseEvent('swap.requested', data);
    });

    client.on('swap.approved', (event) => {
      const data = JSON.parse(event.data);
      addSseEvent('swap.approved', data);
    });

    client.on('ping', (event) => {
      const data = JSON.parse(event.data);
      addSseEvent('ping', data);
    });

    sseClientRef.current = client;
    client.connect();

    return () => {
      client.disconnect();
    };
  }, []);

  const addSseEvent = (type: string, data: any) => {
    setSseEvents(prev => [
      {
        time: new Date().toLocaleTimeString(),
        type,
        data,
      },
      ...prev.slice(0, 49), // Keep last 50 events
    ]);
  };

  // Subscribe to push notifications
  const subscribePush = async () => {
    try {
      // Mock subscription for testing
      const mockSubscription = {
        endpoint: 'https://fcm.googleapis.com/fcm/send/test-endpoint-123',
        expirationTime: null,
        keys: {
          p256dh: 'test-public-key',
          auth: 'test-auth-key',
        },
      };

      const response = await fetch('/api/push/subscribe', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-tenant-id': 'test-tenant',
          'x-user-id': 'test-user',
        },
        body: JSON.stringify({
          subscription: mockSubscription,
          topics: ['schedule', 'swap', 'emergency'],
        }),
      });

      const result = await response.json();
      if (result.success) {
        setPushSubscribed(true);
        alert('Push notifications subscribed!');
      }
    } catch (error) {
      console.error('Push subscription error:', error);
      alert('Failed to subscribe to push notifications');
    }
  };

  // Unsubscribe from push notifications
  const unsubscribePush = async () => {
    try {
      const response = await fetch('/api/push/subscribe?endpoint=https://fcm.googleapis.com/fcm/send/test-endpoint-123', {
        method: 'DELETE',
        headers: {
          'x-tenant-id': 'test-tenant',
          'x-user-id': 'test-user',
        },
      });

      const result = await response.json();
      if (result.success) {
        setPushSubscribed(false);
        alert('Push notifications unsubscribed!');
      }
    } catch (error) {
      console.error('Push unsubscribe error:', error);
      alert('Failed to unsubscribe from push notifications');
    }
  };

  // Send test notification
  const sendTestNotification = async (type: string, priority: string) => {
    try {
      const notificationData = {
        type,
        priority,
        title: `Test ${type} Notification`,
        message: `This is a test ${priority} priority notification for ${type}`,
        data: {
          testId: Date.now(),
          timestamp: new Date().toISOString(),
        },
        userId: 'test-user',
        actionUrl: '/test',
        actions: priority === 'high' || priority === 'urgent' ? [
          {
            id: 'action1',
            label: 'Accept',
            action: 'accept',
            style: 'primary',
          },
          {
            id: 'action2',
            label: 'Reject',
            action: 'reject',
            style: 'secondary',
          },
        ] : undefined,
      };

      const response = await fetch('/api/notifications', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-tenant-id': 'test-tenant',
          'x-user-id': 'test-user',
        },
        body: JSON.stringify(notificationData),
      });

      const result = await response.json();
      console.log('Send notification response:', result);
      if (result.success) {
        console.log('Notification sent successfully, fetching inbox...');
        // ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ Ïù∏Î∞ïÏä§ Í∞ÄÏ†∏Ïò§Í∏∞
        setTimeout(() => {
          fetchNotifications();
        }, 100);
      }
    } catch (error) {
      console.error('Send notification error:', error);
      alert('Failed to send notification');
    }
  };

  // Fetch notifications inbox
  const fetchNotifications = async () => {
    try {
      const response = await fetch('/api/notifications', {
        headers: {
          'x-tenant-id': 'test-tenant',
          'x-user-id': 'test-user',
        },
      });

      const result = await response.json();
      console.log('Fetch notifications response:', result);
      if (result.success) {
        console.log('Inbox data:', result.inbox);
        setNotifications(result.inbox.notifications);
        setUnreadCount(result.inbox.unreadCount);
      }
    } catch (error) {
      console.error('Fetch notifications error:', error);
    }
  };

  // Mark notification as read
  const markAsRead = async (notificationId: string) => {
    try {
      const response = await fetch('/api/notifications', {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
          'x-tenant-id': 'test-tenant',
          'x-user-id': 'test-user',
        },
        body: JSON.stringify({ notificationId }),
      });

      const result = await response.json();
      if (result.success) {
        fetchNotifications();
      }
    } catch (error) {
      console.error('Mark as read error:', error);
    }
  };

  // Clear all notifications
  const clearNotifications = async () => {
    try {
      const response = await fetch('/api/notifications', {
        method: 'DELETE',
        headers: {
          'x-tenant-id': 'test-tenant',
          'x-user-id': 'test-user',
        },
      });

      const result = await response.json();
      if (result.success) {
        setNotifications([]);
        setUnreadCount(0);
      }
    } catch (error) {
      console.error('Clear notifications error:', error);
    }
  };

  // Load notifications on mount
  useEffect(() => {
    fetchNotifications();
  }, []);

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <header className="bg-white border-b border-gray-200">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center justify-between h-16">
            <h1 className="text-xl font-semibold text-gray-900">Real-time API Test</h1>
            <div className="flex items-center gap-4">
              <div className="flex items-center gap-2">
                {sseConnected ? (
                  <>
                    <Wifi className="w-5 h-5 text-green-500" />
                    <span className="text-sm text-green-600">SSE Connected</span>
                  </>
                ) : (
                  <>
                    <WifiOff className="w-5 h-5 text-red-500" />
                    <span className="text-sm text-red-600">SSE Disconnected</span>
                  </>
                )}
              </div>
              <div className="relative">
                <Bell className="w-5 h-5 text-gray-600" />
                {unreadCount > 0 && (
                  <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">
                    {unreadCount}
                  </span>
                )}
              </div>
            </div>
          </div>
        </div>
      </header>

      {/* Tabs */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div className="flex gap-4 border-b border-gray-200">
          <button
            onClick={() => setActiveTab('guide')}
            className={`px-4 py-2 font-medium ${
              activeTab === 'guide'
                ? 'text-blue-600 border-b-2 border-blue-600'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            üìñ ÌÖåÏä§Ìä∏ Í∞ÄÏù¥Îìú
          </button>
          <button
            onClick={() => setActiveTab('sse')}
            className={`px-4 py-2 font-medium ${
              activeTab === 'sse'
                ? 'text-blue-600 border-b-2 border-blue-600'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            SSE Events
          </button>
          <button
            onClick={() => setActiveTab('push')}
            className={`px-4 py-2 font-medium ${
              activeTab === 'push'
                ? 'text-blue-600 border-b-2 border-blue-600'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            Push Notifications
          </button>
          <button
            onClick={() => setActiveTab('notifications')}
            className={`px-4 py-2 font-medium relative ${
              activeTab === 'notifications'
                ? 'text-blue-600 border-b-2 border-blue-600'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            Notifications Inbox
            {unreadCount > 0 && (
              <span className="ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-0.5">
                {unreadCount}
              </span>
            )}
          </button>
        </div>
      </div>

      {/* Content */}
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Test Guide Tab */}
        {activeTab === 'guide' && (
          <div className="space-y-6">
            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
              <h2 className="text-2xl font-bold mb-6 text-gray-900">üöÄ Ïã§ÏãúÍ∞Ñ API ÌÖåÏä§Ìä∏ Í∞ÄÏù¥Îìú</h2>

              <div className="space-y-8">
                {/* SSE ÌÖåÏä§Ìä∏ Í∞ÄÏù¥Îìú */}
                <div>
                  <h3 className="text-lg font-semibold mb-3 text-blue-600">1Ô∏è‚É£ SSE (Server-Sent Events) ÌÖåÏä§Ìä∏</h3>
                  <div className="bg-blue-50 p-4 rounded-lg space-y-3">
                    <p className="text-sm text-gray-700">Ïã§ÏãúÍ∞Ñ ÏÑúÎ≤Ñ Ïù¥Î≤§Ìä∏ Ïä§Ìä∏Î¶¨Î∞çÏùÑ ÌÖåÏä§Ìä∏Ìï©ÎãàÎã§.</p>
                    <ol className="list-decimal list-inside space-y-2 text-sm text-gray-600">
                      <li><strong>Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏</strong>: ÏÉÅÎã® Ïö∞Ï∏°Ïùò WiFi ÏïÑÏù¥ÏΩòÏù¥ Ï¥àÎ°ùÏÉâÏúºÎ°ú ÌëúÏãúÎêòÎäîÏßÄ ÌôïÏù∏</li>
                      <li><strong>SSE Events ÌÉ≠</strong>ÏúºÎ°ú Ïù¥Îèô</li>
                      <li><strong>"Send Test Event"</strong> Î≤ÑÌäº ÌÅ¥Î¶≠ÌïòÏó¨ ÌÖåÏä§Ìä∏ Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ°</li>
                      <li>Ïù¥Î≤§Ìä∏ Î°úÍ∑∏ÏóêÏÑú Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÏàòÏã†ÎêòÎäî Ïù¥Î≤§Ìä∏ ÌôïÏù∏</li>
                      <li>Í∞Å Ïù¥Î≤§Ìä∏Ïùò ÌÉÄÏûÖ, ÏãúÍ∞Ñ, Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏</li>
                    </ol>
                    <div className="mt-3 p-3 bg-white rounded border border-blue-200">
                      <p className="text-xs font-mono text-gray-600">
                        üí° ÌåÅ: SSEÎäî ÏûêÎèôÏúºÎ°ú Ïû¨Ïó∞Í≤∞ÎêòÎ©∞, 30Ï¥àÎßàÎã§ heartbeatÍ∞Ä Ï†ÑÏÜ°Îê©ÎãàÎã§.
                      </p>
                    </div>
                  </div>
                </div>

                {/* Push ÏïåÎ¶º ÌÖåÏä§Ìä∏ Í∞ÄÏù¥Îìú */}
                <div>
                  <h3 className="text-lg font-semibold mb-3 text-green-600">2Ô∏è‚É£ Push Notifications ÌÖåÏä§Ìä∏</h3>
                  <div className="bg-green-50 p-4 rounded-lg space-y-3">
                    <p className="text-sm text-gray-700">Web Push ÏïåÎ¶º Íµ¨ÎèÖ Î∞è Ï†ÑÏÜ°ÏùÑ ÌÖåÏä§Ìä∏Ìï©ÎãàÎã§.</p>
                    <ol className="list-decimal list-inside space-y-2 text-sm text-gray-600">
                      <li><strong>Push Notifications ÌÉ≠</strong>ÏúºÎ°ú Ïù¥Îèô</li>
                      <li><strong>"Subscribe to Push"</strong> Î≤ÑÌäº ÌÅ¥Î¶≠ÌïòÏó¨ Push ÏïåÎ¶º Íµ¨ÎèÖ</li>
                      <li>Íµ¨ÎèÖ ÏÑ±Í≥µ Î©îÏãúÏßÄ ÌôïÏù∏</li>
                      <li>Îã§ÏñëÌïú ÏïåÎ¶º ÌÉÄÏûÖ Î≤ÑÌäº ÌÅ¥Î¶≠:
                        <ul className="list-disc list-inside ml-4 mt-1">
                          <li><strong>Schedule Published</strong>: Ïä§ÏºÄÏ§Ñ Î∞úÌñâ ÏïåÎ¶º (ÎÜíÏùÄ Ïö∞ÏÑ†ÏàúÏúÑ)</li>
                          <li><strong>Swap Request</strong>: Í∑ºÎ¨¥ ÍµêÌôò ÏöîÏ≤≠ ÏïåÎ¶º</li>
                          <li><strong>Emergency Call</strong>: Í∏¥Í∏â Ìò∏Ï∂ú ÏïåÎ¶º (ÏµúÍ≥† Ïö∞ÏÑ†ÏàúÏúÑ)</li>
                          <li><strong>Shift Reminder</strong>: Í∑ºÎ¨¥ ÏïåÎ¶º (Ï§ëÍ∞Ñ Ïö∞ÏÑ†ÏàúÏúÑ)</li>
                        </ul>
                      </li>
                      <li>Î∏åÎùºÏö∞Ï†Ä ÏΩòÏÜîÏóêÏÑú Push Ï†ÑÏÜ° Î°úÍ∑∏ ÌôïÏù∏</li>
                    </ol>
                    <div className="mt-3 p-3 bg-white rounded border border-green-200">
                      <p className="text-xs font-mono text-gray-600">
                        üí° ÌåÅ: ÎÜíÏùÄ Ïö∞ÏÑ†ÏàúÏúÑ(high, urgent) ÏïåÎ¶ºÎßå Ïã§Ï†ú PushÍ∞Ä Ï†ÑÏÜ°Îê©ÎãàÎã§.
                      </p>
                    </div>
                  </div>
                </div>

                {/* ÏïåÎ¶º Ïù∏Î∞ïÏä§ ÌÖåÏä§Ìä∏ Í∞ÄÏù¥Îìú */}
                <div>
                  <h3 className="text-lg font-semibold mb-3 text-purple-600">3Ô∏è‚É£ Notifications Inbox ÌÖåÏä§Ìä∏</h3>
                  <div className="bg-purple-50 p-4 rounded-lg space-y-3">
                    <p className="text-sm text-gray-700">ÏïåÎ¶º Ïù∏Î∞ïÏä§ Í∏∞Îä•ÏùÑ ÌÖåÏä§Ìä∏Ìï©ÎãàÎã§.</p>
                    <ol className="list-decimal list-inside space-y-2 text-sm text-gray-600">
                      <li><strong>Notifications Inbox ÌÉ≠</strong>ÏúºÎ°ú Ïù¥Îèô</li>
                      <li>Î®ºÏ†Ä Îã§Î•∏ ÌÉ≠ÏóêÏÑú ÌÖåÏä§Ìä∏ ÏïåÎ¶ºÏùÑ Ïó¨Îü¨ Í∞ú Ï†ÑÏÜ°</li>
                      <li>Ïù∏Î∞ïÏä§ÏóêÏÑú ÏïåÎ¶º Î™©Î°ù ÌôïÏù∏:
                        <ul className="list-disc list-inside ml-4 mt-1">
                          <li>ÏÉà ÏïåÎ¶ºÏùÄ <span className="text-xs bg-blue-100 text-blue-600 px-2 py-0.5 rounded">New</span> Î∞∞ÏßÄ ÌëúÏãú</li>
                          <li>Í∏¥Í∏â ÏïåÎ¶ºÏùÄ üö® ÏïÑÏù¥ÏΩò ÌëúÏãú</li>
                        </ul>
                      </li>
                      <li>ÏïåÎ¶º Ïö∞Ï∏°Ïùò <strong>‚úì Ï≤¥ÌÅ¨ Î≤ÑÌäº</strong> ÌÅ¥Î¶≠ÌïòÏó¨ ÏùΩÏùå Ï≤òÎ¶¨</li>
                      <li>Ïï°ÏÖò Î≤ÑÌäº ÌÖåÏä§Ìä∏ (Approve/Reject Îì±)</li>
                      <li>ÏÉÅÎã® <strong>üóëÔ∏è Ìú¥ÏßÄÌÜµ Î≤ÑÌäº</strong>ÏúºÎ°ú Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</li>
                      <li>ÏÉÅÎã® <strong>üîÑ ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäº</strong>ÏúºÎ°ú Ïù∏Î∞ïÏä§ Í∞±Ïã†</li>
                    </ol>
                    <div className="mt-3 p-3 bg-white rounded border border-purple-200">
                      <p className="text-xs font-mono text-gray-600">
                        üí° ÌåÅ: ÏÉÅÎã®Ïùò Î≤® ÏïÑÏù¥ÏΩò ÏòÜ Ïà´ÏûêÎäî ÏùΩÏßÄ ÏïäÏùÄ ÏïåÎ¶º Í∞úÏàòÏûÖÎãàÎã§.
                      </p>
                    </div>
                  </div>
                </div>

                {/* ÏãúÎÇòÎ¶¨Ïò§ ÌÖåÏä§Ìä∏ */}
                <div>
                  <h3 className="text-lg font-semibold mb-3 text-orange-600">4Ô∏è‚É£ ÌÜµÌï© ÏãúÎÇòÎ¶¨Ïò§ ÌÖåÏä§Ìä∏</h3>
                  <div className="bg-orange-50 p-4 rounded-lg space-y-3">
                    <p className="text-sm text-gray-700">Ïã§Ï†ú ÏÇ¨Ïö© ÏãúÎÇòÎ¶¨Ïò§Î•º Îî∞Îùº ÌÖåÏä§Ìä∏Ìï¥Î≥¥ÏÑ∏Ïöî.</p>
                    <div className="space-y-4">
                      <div className="p-3 bg-white rounded border border-orange-200">
                        <h4 className="font-semibold text-sm mb-2">üìÖ Ïä§ÏºÄÏ§Ñ Î∞úÌñâ ÏãúÎÇòÎ¶¨Ïò§</h4>
                        <ol className="list-decimal list-inside text-xs text-gray-600 space-y-1">
                          <li>Push ÏïåÎ¶º Íµ¨ÎèÖ</li>
                          <li>"Schedule Published" ÏïåÎ¶º Ï†ÑÏÜ°</li>
                          <li>SSE ÌÉ≠ÏóêÏÑú Ïã§ÏãúÍ∞Ñ Ïù¥Î≤§Ìä∏ ÌôïÏù∏</li>
                          <li>Ïù∏Î∞ïÏä§ÏóêÏÑú ÏïåÎ¶º ÌôïÏù∏ Î∞è ÏùΩÏùå Ï≤òÎ¶¨</li>
                        </ol>
                      </div>

                      <div className="p-3 bg-white rounded border border-orange-200">
                        <h4 className="font-semibold text-sm mb-2">üîÑ Í∑ºÎ¨¥ ÍµêÌôò ÏãúÎÇòÎ¶¨Ïò§</h4>
                        <ol className="list-decimal list-inside text-xs text-gray-600 space-y-1">
                          <li>"Swap Request" ÏïåÎ¶º Ï†ÑÏÜ°</li>
                          <li>Ïù∏Î∞ïÏä§ÏóêÏÑú Ïï°ÏÖò Î≤ÑÌäº ÌôïÏù∏ (Approve/Reject)</li>
                          <li>SSE Ïù¥Î≤§Ìä∏ Î°úÍ∑∏ÏóêÏÑú swap.requested Ïù¥Î≤§Ìä∏ ÌôïÏù∏</li>
                        </ol>
                      </div>

                      <div className="p-3 bg-white rounded border border-orange-200">
                        <h4 className="font-semibold text-sm mb-2">üö® Í∏¥Í∏â Ìò∏Ï∂ú ÏãúÎÇòÎ¶¨Ïò§</h4>
                        <ol className="list-decimal list-inside text-xs text-gray-600 space-y-1">
                          <li>"Emergency Call" ÏïåÎ¶º Ï†ÑÏÜ°</li>
                          <li>ÏµúÍ≥† Ïö∞ÏÑ†ÏàúÏúÑ ÏïåÎ¶º ÌôïÏù∏ (üö® ÏïÑÏù¥ÏΩò)</li>
                          <li>Accept Ïï°ÏÖò Î≤ÑÌäº ÌÖåÏä§Ìä∏</li>
                        </ol>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Î¨∏Ï†ú Ìï¥Í≤∞ */}
                <div>
                  <h3 className="text-lg font-semibold mb-3 text-red-600">‚ö†Ô∏è Î¨∏Ï†ú Ìï¥Í≤∞</h3>
                  <div className="bg-red-50 p-4 rounded-lg space-y-3">
                    <div className="space-y-3 text-sm text-gray-600">
                      <div>
                        <strong>SSE Ïó∞Í≤∞Ïù¥ Ïïà Îê† Îïå:</strong>
                        <ul className="list-disc list-inside ml-4 mt-1">
                          <li>Í∞úÎ∞ú ÏÑúÎ≤ÑÍ∞Ä Ïã§Ìñâ Ï§ëÏù∏ÏßÄ ÌôïÏù∏ (npm run dev)</li>
                          <li>Î∏åÎùºÏö∞Ï†Ä ÏΩòÏÜîÏóêÏÑú ÏóêÎü¨ Î©îÏãúÏßÄ ÌôïÏù∏</li>
                          <li>ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ® ÌõÑ Ïû¨ÏãúÎèÑ</li>
                        </ul>
                      </div>
                      <div>
                        <strong>Push Íµ¨ÎèÖÏù¥ Ïã§Ìå®Ìï† Îïå:</strong>
                        <ul className="list-disc list-inside ml-4 mt-1">
                          <li>Î∏åÎùºÏö∞Ï†ÄÍ∞Ä Push APIÎ•º ÏßÄÏõêÌïòÎäîÏßÄ ÌôïÏù∏</li>
                          <li>HTTPS ÌôòÍ≤ΩÏóêÏÑúÎßå ÏûëÎèô (localhostÎäî ÏòàÏô∏)</li>
                        </ul>
                      </div>
                      <div>
                        <strong>ÏïåÎ¶ºÏù¥ ÌëúÏãúÎêòÏßÄ ÏïäÏùÑ Îïå:</strong>
                        <ul className="list-disc list-inside ml-4 mt-1">
                          <li>Notifications Inbox ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäº ÌÅ¥Î¶≠</li>
                          <li>ÎÑ§Ìä∏ÏõåÌÅ¨ ÌÉ≠ÏóêÏÑú API ÏùëÎãµ ÌôïÏù∏</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* SSE Events Tab */}
        {activeTab === 'sse' && (
          <div className="space-y-4">
            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
              <h2 className="text-lg font-medium mb-4">Server-Sent Events</h2>

              <div className="space-y-4">
                <div className="flex gap-4">
                  <button
                    onClick={() => sendTestNotification('general', 'low')}
                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                  >
                    Send Test Event
                  </button>
                  <button
                    onClick={() => setSseEvents([])}
                    className="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700"
                  >
                    Clear Events
                  </button>
                </div>

                <div className="border border-gray-200 rounded-lg p-4 max-h-96 overflow-y-auto">
                  {sseEvents.length === 0 ? (
                    <p className="text-gray-500 text-center">No events received yet</p>
                  ) : (
                    <div className="space-y-2">
                      {sseEvents.map((event, index) => (
                        <div key={index} className="border-b border-gray-100 pb-2">
                          <div className="flex items-center justify-between">
                            <span className="text-sm font-medium text-gray-700">
                              {event.type}
                            </span>
                            <span className="text-xs text-gray-500">{event.time}</span>
                          </div>
                          <pre className="text-xs text-gray-600 mt-1 overflow-x-auto">
                            {JSON.stringify(event.data, null, 2)}
                          </pre>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        )}

        {/* Push Notifications Tab */}
        {activeTab === 'push' && (
          <div className="space-y-4">
            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
              <h2 className="text-lg font-medium mb-4">Web Push Notifications</h2>

              <div className="space-y-4">
                <div className="flex items-center gap-4">
                  {!pushSubscribed ? (
                    <button
                      onClick={subscribePush}
                      className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                    >
                      Subscribe to Push
                    </button>
                  ) : (
                    <>
                      <button
                        onClick={unsubscribePush}
                        className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"
                      >
                        Unsubscribe
                      </button>
                      <span className="text-sm text-green-600">‚úì Push notifications enabled</span>
                    </>
                  )}
                </div>

                <div className="border-t pt-4">
                  <h3 className="font-medium mb-2">Send Test Push Notification</h3>
                  <div className="grid grid-cols-2 gap-2">
                    <button
                      onClick={() => sendTestNotification('schedule_published', 'high')}
                      className="px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700"
                    >
                      Schedule Published
                    </button>
                    <button
                      onClick={() => sendTestNotification('swap_requested', 'high')}
                      className="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                    >
                      Swap Request
                    </button>
                    <button
                      onClick={() => sendTestNotification('emergency_call', 'urgent')}
                      className="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700"
                    >
                      Emergency Call
                    </button>
                    <button
                      onClick={() => sendTestNotification('shift_reminder', 'medium')}
                      className="px-3 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700"
                    >
                      Shift Reminder
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* Notifications Inbox Tab */}
        {activeTab === 'notifications' && (
          <div className="space-y-4">
            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-lg font-medium">Notifications Inbox</h2>
                <div className="flex gap-2">
                  <button
                    onClick={fetchNotifications}
                    className="p-2 hover:bg-gray-100 rounded-lg"
                  >
                    <RefreshCw className="w-4 h-4" />
                  </button>
                  <button
                    onClick={clearNotifications}
                    className="p-2 hover:bg-gray-100 rounded-lg"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>
              </div>

              <div className="space-y-2">
                {notifications.length === 0 ? (
                  <p className="text-gray-500 text-center py-8">No notifications</p>
                ) : (
                  notifications.map((notification) => (
                    <div
                      key={notification.id}
                      className={`border rounded-lg p-4 ${
                        notification.readAt ? 'bg-gray-50' : 'bg-white border-blue-200'
                      }`}
                    >
                      <div className="flex items-start justify-between">
                        <div className="flex-1">
                          <div className="flex items-center gap-2">
                            {notification.priority === 'urgent' && (
                              <AlertCircle className="w-4 h-4 text-red-500" />
                            )}
                            <h3 className="font-medium text-gray-900">
                              {notification.title}
                            </h3>
                            {!notification.readAt && (
                              <span className="text-xs bg-blue-100 text-blue-600 px-2 py-0.5 rounded">
                                New
                              </span>
                            )}
                          </div>
                          <p className="text-sm text-gray-600 mt-1">
                            {notification.message}
                          </p>
                          <div className="flex items-center gap-4 mt-2">
                            <span className="text-xs text-gray-500">
                              {new Date(notification.createdAt).toLocaleString()}
                            </span>
                            {notification.actions && (
                              <div className="flex gap-2">
                                {notification.actions.map((action: any) => (
                                  <button
                                    key={action.id}
                                    className={`text-xs px-2 py-1 rounded ${
                                      action.style === 'primary'
                                        ? 'bg-blue-600 text-white'
                                        : action.style === 'danger'
                                        ? 'bg-red-600 text-white'
                                        : 'bg-gray-200 text-gray-700'
                                    }`}
                                  >
                                    {action.label}
                                  </button>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                        {!notification.readAt && (
                          <button
                            onClick={() => markAsRead(notification.id)}
                            className="p-1 hover:bg-gray-100 rounded"
                          >
                            <Check className="w-4 h-4 text-green-600" />
                          </button>
                        )}
                      </div>
                    </div>
                  ))
                )}
              </div>
            </div>
          </div>
        )}
      </main>
    </div>
  );
}